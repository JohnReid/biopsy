#
# Copyright John Reid 2009
#

"""
Code that defines a few PSSMs for Sp1.
"""

import numpy as N


def transfac_sp1():
    # TRANSFAC sp1
    freqs = N.array(
        [
            [ 37      ,17      ,137      ,44 ],
            [ 26     ,4     ,204     ,1  ]   ,
            [ 0     ,3     ,230     ,2   ]  ,
            [ 0     ,0     ,234     ,1   ]  ,
            [ 40     ,159     ,5     ,31 ],
            [ 7     ,6     ,214     ,8   ]  ,
            [ 1     ,2     ,212     ,20 ],
            [ 39     ,16     ,169     ,11 ],
            [ 31     ,31     ,155     ,18 ],
            [ 31     ,119     ,40     ,45 ],
        ],
        dtype=N.float64
    )
    gaps = N.ones(len(freqs))
    return freqs, gaps

def meme_sp1():
    # MEME Sp1
    freqs = N.array(
        [
            [ 0.000000,  0.181818,  0.000000,  0.818182 ],
            [ 0.727273,  0.030303,  0.000000,  0.242424 ],
            [ 0.000000,  0.000000,  0.000000,  1.000000 ],
            [ 0.000000,  0.000000,  0.000000,  1.000000 ],
            [ 0.000000,  0.000000,  0.000000,  1.000000 ],
            [ 0.060606,  0.000000,  0.484848,  0.454545 ],
            [ 0.424242,  0.030303,  0.000000,  0.545455 ],
            [ 0.757576,  0.181818,  0.030303,  0.030303 ],
            [ 0.818182,  0.000000,  0.000000,  0.181818 ],
            [ 0.666667,  0.000000,  0.333333,  0.000000 ],
            [ 0.030303,  0.000000,  0.000000,  0.969697 ],
            [ 0.424242,  0.181818,  0.060606,  0.333333 ],
            [ 0.151515,  0.363636,  0.000000,  0.484848 ],
            [ 0.000000,  0.000000,  0.000000,  1.000000 ],
            [ 0.424242,  0.000000,  0.181818,  0.393939 ],
            [ 0.000000,  0.000000,  0.000000,  1.000000 ],
        ],
        dtype=N.float64
    )
    gaps = N.ones(len(freqs))
    return freqs, gaps

def gapped_sp1():
    # Sp1 frequencies and gap
    freqs = N.array(
        [
            [ 0.0933702382725,0.242248047918,0.566206988199,0.0981747256098        ],
            [ 1.16094945149e-08,0.67653521585,0.00610826470716,0.317356507834      ],
            [ 7.13315935192e-11,0.87168908789,6.22903972303e-05,0.128248621642     ],
            [ 1.43918642857e-07,0.993525315867,1.28219159736e-16,0.00647454021475  ],
            [ 1.20896878223e-08,0.999999215443,9.30869032889e-19,7.72467729618e-07 ],
            [ 0.0356652209825,0.0185904602858,1.06129495172e-11,0.945744318721     ],
            [ 0.125408435326,3.93276509946e-15,0.648809170375,0.225782394299       ],
            [ 7.98397498566e-09,0.99919057356,0.000160248916246,0.000649169539886  ],
            [ 1.88950891252e-10,0.998649985294,2.45236030926e-13,0.00135001451637  ],
            [ 1.82878927635e-15,0.944192619205,1.26450262074e-11,0.0558073807819   ],
            [ 0.17319780881,0.779436828144,6.97591450816e-16,0.0473653630463       ],
            [ 0.246824694996,0.453994213412,0.137368283321,0.16181280827           ],
            [ 0.279186787399,0.285921551901,0.285684295696,0.149207365005          ],
        ]
    )
    gaps = N.ones(len(freqs))
    gaps[5] = 0.321088
    return freqs, gaps


def gapped_sp1_new():
    # Sp1 frequencies and gap
    freqs = N.array(
        [
            [ 0.186785101021,0.587845358618,0.00848574294772,0.216883797414        ],
            [ 0.359222657972,0.0333777135123,0.370488264929,0.236911363587         ],
            [ 1.59614269547e-05,0.297618935294,0.616342806449,0.0860222968305      ],
            [ 3.19932006542e-11,0.745079364688,0.00133373674262,0.253586898538     ],
            [ 0.000443370197171,0.819787318812,3.81480274795e-07,0.17976892951     ],
            [ 3.34425803592e-05,0.999966557402,5.56627580268e-13,1.66546231575e-11 ],
            [ 2.66390612584e-13,0.987964274709,1.12510655262e-25,0.0120357252907   ],
            [ 0.00109097530939,0.129086334185,5.87222556298e-07,0.869822103283     ],
            [ 0.137832621168,1.9076828876e-12,0.601195221947,0.260972156883        ],
            [ 3.85147770398e-13,0.999989418827,1.05811726003e-05,2.78313690307e-14 ],
            [ 3.42719400537e-07,0.99976898106,3.4293289113e-06,0.000227246891995   ],
            [ 5.0745182996e-13,0.798893150084,2.60789684158e-11,0.201106849889     ],
            [ 0.17716136756,0.768236876299,1.80412516659e-06,0.054599952016        ],
            [ 0.376559913573,0.418943511567,0.0813956343091,0.12310094055          ],
            [ 0.347916175445,0.280344582628,0.242192898884,0.129546343043          ],
            [ 0.0708946827535,0.582404616209,0.278877639762,0.0678230612759        ],
        ]
    )
    gaps = N.ones(len(freqs))
    gaps[7] = 0.321088
    return freqs, gaps


def ungapped_sp1_new():
    # Sp1 frequencies and gap
    freqs = N.array(
        [
            [ 0.344663201498,0.25265054019,0.155410118916,0.247276139396           ],
            [ 0.279945935704,0.192669908766,0.47505333956,0.0523308159692          ],
            [ 0.064921789019,0.129628262022,0.594786137014,0.210663811945          ],
            [ 1.7185849137e-11,0.926814235893,0.00907918167979,0.0641065824104     ],
            [ 0.00822773919586,0.912376516438,1.40533706116e-22,0.0793957443658    ],
            [ 0.0398809534344,0.960119046566,3.50709184671e-16,1.70452567439e-14   ],
            [ 3.86838928716e-07,0.73051163118,4.42465253518e-23,0.269487981981     ],
            [ 0.194329836037,1.88163857976e-24,0.690743148429,0.114927015534       ],
            [ 1.30032679773e-10,0.989758949953,0.0102410362718,1.36456358683e-08   ],
            [ 6.36324469381e-13,0.999999999801,2.20582307337e-12,1.95745653531e-10 ],
            [ 1.46453261464e-20,0.999999980391,4.4882571579e-11,1.95645946638e-08  ],
            [ 0.198133314596,0.744969547147,9.49383979558e-06,0.0568876444171      ],
            [ 0.231494801097,0.523156454202,0.107078809507,0.138269935195          ],
            [ 0.336212717808,0.244712552882,0.235815050724,0.183259678585          ],
            [ 0.0527584605607,0.482189986359,0.338209798543,0.126841754537         ],
        ]
    )
    gaps = N.ones(len(freqs))
    return freqs, gaps


def glam2_sp1_i4():
    "GLAM2 gapped : ans-p61ns-T00759-glam2-RM-z3-i4-logo-jr-format"
    freqs = N.array(
        [
            [ 0 , 0.712727 , 0.287273 , 0 ],
            [ 0.6 , 0 , 0 , 0.4 ],
            [ 0 , 0.858182 , 0.127273 , 0.0145455 ],
            [ 0.269091 , 0.00363636 , 0.0690909 , 0.658182 ],
            [ 0.0145455 , 0.505455 , 0.381818 , 0.0981818 ],
            [ 0.04 , 0.745455 , 0.12 , 0.0945455 ],
            [ 0 , 0.975207 , 0 , 0.0247934 ],
            [ 0.283636 , 0.105455 , 0.105455 , 0.505455 ],
            [ 0 , 0.408759 , 0.532847 , 0.0583942 ],
            [ 0.0581818 , 0.629091 , 0.105455 , 0.207273 ],
            [ 0 , 0.509091 , 0.149091 , 0.341818 ],
            [ 0.192727 , 0.356364 , 0.0909091 , 0.36 ],
            [ 0.112727 , 0.48 , 0.189091 , 0.218182 ],
            [ 0.08 , 0.636364 , 0.283636 , 0 ],
            [ 0.301818 , 0.378182 , 0 , 0.32 ],
            [ 0.0109091 , 0.556364 , 0.370909 , 0.0618182 ],
            [ 0.149091 , 0.52 , 0 , 0.330909 ],
            [ 0.476744 , 0 , 0.0116279 , 0.511628 ],
            [ 0.0363636 , 0.447273 , 0.265455 , 0.250909 ],
            [ 0.2 , 0.487273 , 0.00727273 , 0.305455 ],
            [ 0.0909091 , 0 , 0.290909 , 0.618182 ],
            [ 0.138182 , 0.458182 , 0.247273 , 0.156364 ],
            [ 0 , 0.48 , 0.214545 , 0.305455 ],
            [ 0 , 0.883636 , 0.116364 , 0 ],
            [ 0.28 , 0.0363636 , 0.0836364 , 0.6 ],
            [ 0 , 0.374545 , 0.490909 , 0.134545 ],
            [ 0.0654545 , 0.727273 , 0.123636 , 0.0836364 ],
            [ 0.109091 , 0.545455 , 0.0909091 , 0.254545 ],
            [ 0.455556 , 0 , 0.0444444 , 0.5 ],
            [ 0 , 0.792727 , 0.174545 , 0.0327273 ],
            [ 0.0171429 , 0.794286 , 0 , 0.188571 ],
            [ 0.196364 , 0.0618182 , 0 , 0.741818 ],
            [ 0.00363636 , 0.381818 , 0.614545 , 0 ],
            [ 0.0654545 , 0.436364 , 0.258182 , 0.24 ],
        ]
    )
    gaps = N.array(
        [
            1,
            0.327273,
            1,
            1,
            1,
            1,
            0.44,
            1,
            0.498182,
            1,
            1,
            1,
            1,
            1,
            1,
            1,
            1,
            0.312727,
            1,
            1,
            0.2,
            1,
            1,
            1,
            1,
            1,
            1,
            1,
            0.327273,
            1,
            0.636364,
            1,
            1,
            1,
        ]
    )
    return freqs, gaps

def glam2_sp1_i7():
    "GLAM2 gapped : ans-p61ns-T00759-glam2-RM-z3-i4-logo-jr-format"
    freqs = N.array(
        [
            [ 0.228571 , 0.182143 , 0.432143 , 0.157143 ],
            [ 0.117857 , 0.171429 , 0.710714 , 0 ],
            [ 0.15 , 0.517857 , 0.332143 , 0 ],
            [ 0.746429 , 0.0714286 , 0.0642857 , 0.117857 ],
            [ 0 , 0 , 1 , 0 ],
            [ 0.14 , 0.272 , 0.58 , 0.008 ],
            [ 0.100917 , 0.284404 , 0.192661 , 0.422018 ],
            [ 0.167857 , 0.110714 , 0.539286 , 0.182143 ],
            [ 0.107143 , 0.171429 , 0.603571 , 0.117857 ],
            [ 0.110714 , 0.464286 , 0.375 , 0.05 ],
            [ 0.632143 , 0.110714 , 0 , 0.257143 ],
            [ 0 , 0 , 1 , 0 ],
            [ 0.232143 , 0.0607143 , 0.514286 , 0.192857 ],
            [ 0.0321429 , 0.35 , 0.617857 , 0 ],
            [ 0.515924 , 0 , 0 , 0.484076 ],
            [ 0.0392857 , 0.239286 , 0.721429 , 0 ],
            [ 0.664286 , 0 , 0.257143 , 0.0785714 ],
            [ 0.2 , 0.160714 , 0.546429 , 0.0928571 ],
            [ 0 , 0 , 0 , 1 ],
            [ 0 , 0.183333 , 0.816667 , 0 ],
            [ 0.367857 , 0.0142857 , 0.553571 , 0.0642857 ],
            [ 0.146429 , 0.0714286 , 0.682143 , 0.1 ],
            [ 0.335714 , 0.325 , 0.292857 , 0.0464286 ],
            [ 0.342857 , 0.214286 , 0.421429 , 0.0214286 ],
            [ 0.210714 , 0.446429 , 0.342857 , 0 ],
            [ 0.521429 , 0.00357143 , 0.182143 , 0.292857 ],
            [ 0 , 0.128571 , 0.771429 , 0.1 ],
            [ 0.228758 , 0 , 0.509804 , 0.261438 ],
            [ 0.00714286 , 0.239286 , 0.753571 , 0 ],
            [ 0.021978 , 0.978022 , 0 , 0 ],
            [ 0.585714 , 0 , 0.1 , 0.314286 ],
            [ 0.0892857 , 0.0857143 , 0.825 , 0 ],
            [ 0.221429 , 0.0678571 , 0.55 , 0.160714 ],
            [ 0.132143 , 0.267857 , 0.460714 , 0.139286 ],
        ]
    )
    gaps = N.array(
        [
            1,
            1,
            1,
            1,
            1,
            0.892857,
            0.389286,
            1,
            1,
            1,
            1,
            0.5,
            1,
            1,
            0.560714,
            1,
            1,
            1,
            0.153571,
            0.428571,
            1,
            1,
            1,
            1,
            1,
            1,
            1,
            0.546429,
            1,
            0.325,
            1,
            1,
            1,
            1,
        ]
    )
    return freqs, gaps


def all_sp1_pssms():
    return {
        'TRANSFAC'      : transfac_sp1(),
        'MEME'          : meme_sp1(),
        'Gapped'        : gapped_sp1(),
        'Gapped-new'    : gapped_sp1_new(),
        'Ungapped-new'  : ungapped_sp1_new(),
        'GLAM2-i4'      : glam2_sp1_i4(),
        'GLAM2-i7'      : glam2_sp1_i7(),
    }

if '__main__' == __name__:
    import hmm.pssm.logo as L
    for name, (freqs, gaps) in [
        ('TRANSFAC-sp1', transfac_sp1()),
        ('MEME-sp1', meme_sp1()),
        ('Gapped-sp1', gapped_sp1()),
        ('Gapped-sp1-new', gapped_sp1_new()),
        ('Ungapped-sp1-new', ungapped_sp1_new()),
        ('GLAM2-sp1-i4', glam2_sp1_i4()),
        ('GLAM2-sp1-i7', glam2_sp1_i7()),
    ]:
        freqs = (freqs.T / freqs.sum(axis=1)).T
        logo_image = L.pssm_as_image(freqs, transparencies=gaps)
        logo_image.save('%s.png' % name)
